!function(e){"use strict";e.WS_Form.prototype.form_google_address=function(){var o=this,t=e("[data-google-address]:not([data-init-google-address])",this.form_canvas_obj);return!!t.length&&(!!this.form_google_maps_api_init()&&void t.each(function(){e(this).attr("data-init-google-address","");var t={},a=o.get_field(e(this));t.obj=this,t.field_id=o.get_field_id(e(this)),t.field_mapping=o.get_object_meta_value(a,"google_address_field_mapping",[]),t.map_field_id=o.get_object_meta_value(a,"google_address_map",""),t.map_zoom=parseInt(o.get_object_meta_value(a,"google_address_map_zoom","14"),10),t.map_geolocate_on_click=o.get_object_meta_value(a,"google_address_map_geolocate_on_click",""),t.auto_complete=o.get_object_meta_value(a,"google_address_auto_complete",""),t.auto_complete_on_load=o.get_object_meta_value(a,"google_address_auto_complete_on_load",""),t.place_id_validation=o.get_object_meta_value(a,"google_address_place_id_validation","on");var _=o.get_object_meta_value(a,"google_address_place_id_invalid_message",o.language("google_address_place_id_invalid_message"));""==_&&(_=o.language("google_address_place_id_invalid_message")),t.place_id_invalid_message=_;var s=o.get_object_meta_value(a,"google_address_restriction_country",[]);if(t.restriction_country=[],"object"==typeof s&&s.length)for(var l in s)if(s.hasOwnProperty(l)){var r=s[l];r.country_alpha_2&&t.restriction_country.push(r.country_alpha_2)}t.restriction_business=o.get_object_meta_value(a,"google_address_restriction_business",""),o.google_address_process(t)}))},e.WS_Form.prototype.google_address_process=function(o,t){var a=this;if(void 0===t&&(t=(new Date).getTime()),(new Date).getTime()-t>this.timeout_google_maps)return this.error("error_timeout_google_maps"),!1;if(window.google&&window.google.maps&&window.google.maps.places&&window.google.maps.places.Autocomplete&&(wsf_google_maps_loaded=!0),!wsf_google_maps_loaded)return setTimeout(function(){a.google_address_process(o,t)},this.timeout_interval),!1;var _={fields:["address_components","business_status","formatted_address","formatted_phone_number","geometry","international_phone_number","name","place_id","rating","url","user_ratings_total","vicinity","website"]};switch(o.restriction_business){case"on":case"establishment":_.types=["establishment"];break;case"address":case"(cities)":case"(regions)":_.types=[o.restriction_business]}"object"==typeof o.restriction_country&&o.restriction_country.length&&(_.componentRestrictions={country:o.restriction_country});var s=new google.maps.places.Autocomplete(o.obj,_);if(s.google_address=o,o.place_id_validation&&e(o.obj).on("input paste",function(){a.google_address_validate(o)}),o.auto_complete_on_load&&this.google_address_auto_complete(o),e(o.obj).on("wsf-auto-complete",function(){a.google_address_auto_complete(o)}),s.addListener("place_changed",function(){var e=this.getPlace();a.google_address_place_set(o,e)}),""!=o.map_field_id&&void 0!==a.google_maps[o.map_field_id]&&o.map_geolocate_on_click){var l=a.google_maps[o.map_field_id];l.map.addListener("click",function(e){a.google_address_geocode(o,e.latLng.lat(),e.latLng.lng())}),l.marker.addListener("dragend",function(e){a.google_address_geocode(o,e.latLng.lat(),e.latLng.lng())})}},e.WS_Form.prototype.google_address_validate=function(o){var t=e(o.obj);void 0!==t.attr("data-place-value-old")&&t.val()!==t.attr("data-place-value-old")&&t.attr("data-place-id")&&!t.attr("data-place-id-old")&&(t.attr("data-place-id-old",t.attr("data-place-id")),t.removeAttr("data-place-id").trigger("wsf-place-id-reset")),void 0!==t.attr("data-place-value-old")&&t.val()===t.attr("data-place-value-old")&&!t.attr("data-place-id")&&t.attr("data-place-id-old")&&(t.attr("data-place-id",t.attr("data-place-id-old")),t.removeAttr("data-place-id-old").trigger("wsf-place-id-set")),t.attr("data-place-id")?this.set_invalid_feedback(t,""):""!==t.val()?this.set_invalid_feedback(t,o.place_id_invalid_message):this.set_invalid_feedback(t,"")},e.WS_Form.prototype.google_address_place_set=function(o,t){var a=[];for(var _ in a.street_full_short="",a.street_full_long="",a.street_full_short_rev="",a.street_full_long_rev="",a.postal_code_full_short="",a.postal_code_full_long="",t.address_components)if(t.address_components.hasOwnProperty(_)){var s=t.address_components[_];switch(s.types[0]){case"street_number":a.street_number_short=s.short_name,a.street_number_long=s.long_name,a.street_full_short=s.short_name+" "+a.street_full_short,a.street_full_long=s.long_name+" "+a.street_full_long,a.street_full_short_rev+=s.short_name,a.street_full_long_rev+=s.long_name;break;case"route":a.route_short=s.short_name,a.route_long=s.long_name,a.street_full_short+=s.short_name,a.street_full_long+=s.long_name,a.street_full_short_rev=s.short_name+" "+a.street_full_short_rev,a.street_full_long_rev=s.long_name+" "+a.street_full_long_rev;break;case"locality":case"postal_town":a.locality_short=s.short_name,a.locality_long=s.long_name;break;case"sublocality":a.sublocality_short=s.short_name,a.sublocality_long=s.long_name;break;case"subpremise":a.subpremise_short=s.short_name,a.subpremise_long=s.long_name;break;case"neighborhood":a.neighborhood_short=s.short_name,a.neighborhood_long=s.long_name;break;case"administrative_area_level_1":a.aal1_short=s.short_name,a.aal1_long=s.long_name;break;case"administrative_area_level_2":a.aal2_short=s.short_name,a.aal2_long=s.long_name;break;case"postal_code":a.postal_code_short=s.short_name,a.postal_code_long=s.long_name,a.postal_code_full_short=s.short_name+a.postal_code_full_short,a.postal_code_full_long=s.long_name+a.postal_code_full_long;break;case"postal_code_suffix":a.postal_code_suffix_short=s.short_name,a.postal_code_suffix_long=s.long_name,a.postal_code_full_short=a.postal_code_full_short+"-"+s.short_name,a.postal_code_full_long=a.postal_code_full_long+"-"+s.long_name;break;case"country":a.country_short=s.short_name,a.country_long=s.long_name}}if(t.geometry&&t.geometry.location){var l=t.geometry.location;a.lat=l.lat(),a.lng=l.lng(),a.lat_lng=l.lat()+","+l.lng()}var r=["business_status","formatted_address","formatted_phone_number","international_phone_number","name","place_id","rating","url","user_ratings_total","vicinity","website"];for(var i in e(o.obj).removeAttr("data-place-id"),r)if(r.hasOwnProperty(i)){var n=r[i];a[n]=t[n]?t[n]:"","place_id"===n&&a[n]&&(e(o.obj).attr("data-place-id",a[n]).removeAttr("data-place-id-old").trigger("wsf-place-id-set"),e(o.obj).attr("data-place-value-old",e(o.obj).val()))}if("object"==typeof o.field_mapping&&o.field_mapping.length)for(var d in o.field_mapping)if(o.field_mapping.hasOwnProperty(d)){var g=o.field_mapping[d],c=void 0!==g.google_address_component?g.google_address_component:"";if(""!=c){void 0===a[c]&&(a[c]="");var p=parseInt(void 0!==g.ws_form_field?g.ws_form_field:"",10);if(0!=p){var m=this.get_section_repeatable_suffix(e(o.obj)),u=e("#"+this.form_id_prefix+"field-wrapper-"+p+m,this.form_canvas_obj),f=e("#"+this.form_id_prefix+"field-"+p+m,this.form_canvas_obj),h=a[c];this.field_value_set(u,f,h),f[0]===e(o.obj)[0]&&e(o.obj).attr("data-place-value-old",h)}}}if(""!=o.map_field_id&&void 0!==this.google_maps[o.map_field_id]&&t.geometry&&t.geometry.location){var v=this.google_maps[o.map_field_id];v.marker_set_position(t.geometry.location,t),t.geometry.viewport&&v.map.fitBounds(t.geometry.viewport),o.map_zoom>0&&v.map.setZoom(o.map_zoom)}o.place_id_validation&&this.google_address_validate(o)},e.WS_Form.prototype.google_address_auto_complete=function(e){var o=this;switch(e.auto_complete){case"browser":if(!navigator.geolocation)break;"function"==typeof this.form_loader_show&&this.form_loader_show("geolocate"),navigator.geolocation.getCurrentPosition(function(t){o.google_address_geocode(e,parseFloat(t.coords.latitude),parseFloat(t.coords.longitude)),"function"==typeof o.form_loader_hide&&o.form_loader_hide()});break;case"ip":o.form_geo_get_element("lat_lng","","google_address_auto_complete_ip",{google_address:e})}},e.WS_Form.prototype.google_address_auto_complete_ip=function(e,o){if(!e||"string"!=typeof e)return!1;var t=e.split(",");if(2!==t.length)return!1;this.google_address_geocode(o.google_address,parseFloat(t[0]),parseFloat(t[1]))},e.WS_Form.prototype.google_address_geocode=function(e,o,t){var a=this;const _=new google.maps.Geocoder;o=parseFloat(o),t=parseFloat(t);if(isNaN(o)||isNaN(t))return!1;const s={lat:o,lng:t};_.geocode({location:s}).then(o=>{if(o.results[0]){var t=o.results[0];a.log("log_google_geocode_success",t.place_id),a.google_address_place_set(e,t)}else a.error("error_geocoder_google_address_no_results")}).catch(e=>{a.error("error_geocoder_google_address_error",e)})}}(jQuery);