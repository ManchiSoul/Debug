!function(e){"use strict";e.WS_Form.prototype.form_calc_clean=function(){for(var t in this.calc)if(this.calc.hasOwnProperty(t)){var a=this.calc[t],i=this.get_part_id(a.field.id,a.section_repeatable_index,"hidden"==a.field.type?"field":"field-wrapper");if(!e("#"+i,this.form_canvas_obj).length)return this.calc.splice(t,1),void this.form_calc_clean()}},e.WS_Form.prototype.form_calc=function(t,a){void 0===t&&(t=!1),void 0===a&&(a=!1);var i=e.extend(!0,[],this.calc);for(var r in i)if(i.hasOwnProperty(r)){var _=i[r];if(!1!==a){if(-1!==_.value.indexOf("#section_row_count")){this.form_calc_do(_,"#section_row_count");continue}if(-1!==_.value.indexOf("#section_row_index")){this.form_calc_do(_,"#section_row_index");continue}var s=_.field.section_id;if(parseInt(s,10)===parseInt(a,10)){this.form_calc_do(_,_.field.id);continue}if(!1===_.section_repeatable_index)for(var c in _.field_ids_touched)if(_.field_ids_touched.hasOwnProperty(c)){var d=_.field_ids_touched[c],o=this.field_data_cache[d],l=void 0!==o.section_repeatable_section_id&&o.section_repeatable_section_id;parseInt(l,10)===parseInt(a,10)&&this.form_calc_do(_,d)}}else if(!1!==t){var n=e("#"+t,this.form_canvas_obj),f=n.attr("data-id-hidden"),p=f?n:n.closest("[data-id]"),m=f?parseInt(f,10):parseInt(p.attr("data-id"),10);if(m===_.field.id&&"value"==_.field_part)continue;var h=_.field_ids_touched;h.length>0&&-1!==h.indexOf(m)&&this.form_calc_do(_,m)}else this.form_calc_do(_,e.WS_Form.debug_rendered?this.language("log_"+_.type+"_init"):"")}},e.WS_Form.prototype.form_calc_do=function(t,a){if(this.log("log_"+t.type+"_fired",t.field.label+" - "+this.esc_html(t.value)+(a?" ("+this.language("log_"+t.type+"_fired_triggered",a)+")":""),t.type),void 0===e.WS_Form.field_type_cache[t.field.type])return!1;var i=e.WS_Form.field_type_cache[t.field.type],r=(i[t.type+"_in"],i[t.type+"_in"]);if("field_label"!=t.field_part&&"field_help"!=t.field_part&&!r)return this.error("error_parse_variable_syntax_error_"+t.type+"_in","ID: "+t.field.id,"parse-variables"),!1;var _=this.form_calc_get_value(t);switch(t.field_part){case"field_text_editor":case"field_html":var s=this.get_part_id(t.field.id,t.section_repeatable_index,"field-wrapper");(n=e("["+("field_text_editor"==t.field_part?"data-text-editor":"data-html")+"]",e("#"+s,this.form_canvas_obj))).html(_);break;case"field_label":var c=this.get_part_id(t.field.id,t.section_repeatable_index,"label"),d=(n=e("#"+c,this.form_canvas_obj)).children(".wsf-required-wrapper");n.html(_),d&&n.append(d);break;case"field_help":var o=this.get_part_id(t.field.id,t.section_repeatable_index,"help");(n=e("#"+o,this.form_canvas_obj)).html(_);break;case"field_placeholder":case"field_min":case"field_max":case"field_min-date":case"field_max-date":case"field_min-time":case"field_max-time":var l=this.get_part_id(t.field.id,t.section_repeatable_index),n=e("#"+l,this.form_canvas_obj),f=t.field_part.substring(6),p=n.attr(f);n.attr(f,_),"function"==typeof this.form_date_datetimepicker_enabled&&this.form_date_datetimepicker_enabled()&&"datetime"===t.field.type&&("function"==typeof n.datetimepicker&&n.datetimepicker("destroy"),"function"==typeof this.form_date_process&&this.form_date_process(n)),p!==n.attr(f)&&n.trigger("change");break;case"field_ecommerce_price_min":case"field_ecommerce_price_max":l=this.get_part_id(t.field.id,t.section_repeatable_index),n=e("#"+l,this.form_canvas_obj),f=t.field_part.substring(6),p=n.attr(f);n.attr("data-ecommerce-"+("field_ecommerce_price_min"===t.field_part?"min":"max"),_),"function"==typeof this.form_ecommerce_input_mask_currency&&this.form_ecommerce_input_mask_currency(n),p!==n.attr(f)&&n.trigger("change");break;case"field_value":l=this.get_part_id(t.field.id,t.section_repeatable_index),n=e("#"+l,this.form_canvas_obj);switch(t.field.type){case"progress":this.form_progress_set_value(n,_);break;case"price":case"price_range":case"price_subtotal":case"cart_price":var m=e.WS_Form.settings_plugin.price_decimals,h=this.get_number(n.val(),0,!0,m),u=this.get_number(_,0,!0,m),g=h!==u;switch(t.field.type){case"price_range":n.val(u);break;default:n.val(_)}g&&n.trigger("change");break;case"color":g=n.val()!==_;n.val(_),g&&(n.trigger("change"),"undefined"!=typeof Coloris&&n[0].dispatchEvent(new Event("input",{bubbles:!0})));break;default:switch(t.field.type){case"number":case"quantity":case"range":case"wc_quantity":g=this.get_number(n.val(),0,!1)!==_;break;default:g=n.val()!==_}if(_=this.esc_html_undo(_),n.val(_),"textarea"==t.field.type&&"function"==typeof this.textarea_set_value&&this.textarea_set_value(n,_),g){var v=n.val();"number"!=t.field.type||isNaN(_)||isNaN(v)||(_=parseFloat(_).toFixed(14),v=parseFloat(v).toFixed(14)),_==v&&g&&n.trigger("change")}}}},e.WS_Form.prototype.form_calc_get_value=function(t){var a=this.parse_variables_process(t.value,t.section_repeatable_index,t.type,t.field,t.field_part,!1).output;switch(t.field_part){case"field_min":case"field_max":switch(t.field.type){case"range":case"price_range":var i=this.get_number(a,0,!1);i%1!=0&&(a=this.get_number_rounded(i,8))}break;case"field_value":var r=this.get_part_id(t.field.id,t.section_repeatable_index),_=e("#"+r,this.form_canvas_obj),s=c=d=!1;switch(t.field.type){case"progress":a=this.get_number(a,0,!1);var c=void 0!==_.attr("max")?_.attr("max"):1,d=void 0!==_.attr("step")?_.attr("step"):d;break;case"range":case"price_range":(a=this.get_number(a,0,!1))%1==0||"range"!==t.field.type&&"price_range"!==t.field.type||(a=this.get_number_rounded(a,8));s=void 0!==_.attr("min")?_.attr("min"):0,c=void 0!==_.attr("max")?_.attr("max"):100,d=void 0!==_.attr("step")?_.attr("step"):1;break;case"price":case"price_subtotal":case"cart_price":case"number":case"quantity":case"wc_quantity":a=this.get_number(a,0,!1);s=void 0!==_.attr("min")?_.attr("min"):s,c=void 0!==_.attr("max")?_.attr("max"):c,d=void 0!==_.attr("step")?_.attr("step"):d;break;case"datetime":if("calc"===t.type&&this.is_integer(a)){var o=_.attr("data-date-format")?_.attr("data-date-format"):ws_form_settings.date_format,l=_.attr("data-time-format")?_.attr("data-time-format"):ws_form_settings.time_format;switch(_.attr("data-date-type")){case"date":var n=o;break;case"time":n=l;break;case"month":n="F Y";break;case"week":var f="";ws_this.language("week").split("").map(e=>{f+="\\"+e});n=f+" W, Y";break;default:n=o+" "+l}a=this.get_number(a,0,!0),a="function"==typeof this.date_format?this.date_format(new Date(1e3*a),n):""}}switch(!1!==s&&a<s&&(a=s),!1!==c&&a>c&&(a=c),!1!==d&&(a=this.get_number_to_step(a,d)),t.field.type){case"price":case"price_range":case"price_subtotal":case"cart_price":a=this.get_price(a,this.get_currency(),!1)}}return a},e.WS_Form.prototype.form_calc_log=function(){if(ws_form_settings.debug)for(var e in this.calc)if(this.calc.hasOwnProperty(e)){var t=this.calc[e];this.log("log_"+t.type+"_registered",t.field.label+" - "+this.esc_html(t.value)+(t.field_ids_touched.length?" ("+this.language("log_"+t.type+"_registered_triggered",t.field_ids_touched.join(", "))+")"+(t.field.id?" ["+t.field.id+"]":""):""),t.type)}}}(jQuery);