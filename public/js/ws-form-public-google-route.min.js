!function(e){"use strict";e.WS_Form.prototype.form_google_route=function(){var a=this,o=e("[data-google-distance]:not([data-init-google-route])",this.form_canvas_obj);return!!o.length&&(!!this.form_google_maps_api_init()&&void o.each(function(){e(this).attr("data-init-google-route",""),e(this).val(0);var o={},t=a.get_field(e(this));o.obj=this,o.field_id=a.get_field_id(e(this)),o.field_id_origin=a.get_object_meta_value(t,"google_route_field_id_origin",!1),o.waypoints=a.get_object_meta_value(t,"google_route_waypoints",!1),o.waypoints_optimize=a.get_object_meta_value(t,"google_route_waypoints_optimize",!1),o.field_id_destination=a.get_object_meta_value(t,"google_route_field_id_destination",!1),o.field_mapping=a.get_object_meta_value(t,"google_route_field_mapping",[]),o.travel_mode=a.get_object_meta_value(t,"google_route_travel_mode","DRIVING"),o.unit_system=a.get_object_meta_value(t,"google_route_unit_system","METRIC"),o.avoid_highways=a.get_object_meta_value(t,"google_route_avoid_highways",""),o.avoid_tolls=a.get_object_meta_value(t,"google_route_avoid_tolls",""),o.avoid_ferries=a.get_object_meta_value(t,"google_route_avoid_ferries",""),o.map_field_id=a.get_object_meta_value(t,"google_route_map",""),a.google_route_process(o)}))},e.WS_Form.prototype.google_route_process=function(a,o){var t=this;if(a.reposition=!0,void 0===o&&(o=(new Date).getTime()),(new Date).getTime()-o>this.timeout_google_maps)return this.error("error_timeout_google_maps"),!1;if(window.google&&window.google.map&&window.google.maps.DirectionsService&&(wsf_google_maps_loaded=!0),!wsf_google_maps_loaded)return setTimeout(function(){t.google_route_process(a,o)},this.timeout_interval),!1;if(!(a.field_id_origin&&a.field_id_destination&&["BICYCLING","DRIVING","TRANSIT","WALKING"].includes(a.travel_mode)&&["METRIC","IMPERIAL"].includes(a.unit_system)))return this.error("error_google_route"),!1;var i=function(a){var o=a.data.google_route,i=e(o.obj),r=a.data.obj_origin,_=a.data.obj_destination,s=a.data.waypoints,n=void 0!==r.attr("data-place-id")&&r.attr("data-place-id"),l=void 0!==_.attr("data-place-id")&&_.attr("data-place-id"),d=r.val(),g=_.val();if(n)var c={placeId:n};else{if(""==d)return!1;c=t.google_route_get_origin_destination(d)}if(l)var f={placeId:l};else{if(""==g)return!1;f=t.google_route_get_origin_destination(g)}var p=[];for(var u in s)if(s.hasOwnProperty(u)){var v=s[u],m=v.selector;e(m).each(function(){var a=void 0!==e(this).attr("data-place-id")&&e(this).attr("data-place-id"),o=e(this).val();if(a)var i={location:{placeId:a}};else{if(""==o)return;i={location:t.google_route_get_origin_destination(o)}}switch(v.type){case"stopover_true":i.stopover=!0;break;case"stopover_false":i.stopover=!1}p.push(i)})}try{var h=new google.maps.DirectionsService,b={origin:c,destination:f,travelMode:o.travel_mode,unitSystem:google.maps.UnitSystem[o.unit_system],avoidFerries:"on"==o.avoid_ferries,avoidHighways:"on"==o.avoid_highways,avoidTolls:"on"==o.avoid_tolls};p.length&&(b.waypoints=p,o.waypoints_optimize&&(b.optimizeWaypoints=!0)),h.route(b,function(a,r){switch(r){case"OK":var _=a.routes[0],s=a.routes[0].legs,n=s.length,l=0,d=0,g="",c="",f="",p="",u="",v="";for(var m in s)if(s.hasOwnProperty(m)){var h=s[m];l+=h.distance.value,d+=h.duration.value,0==m&&(g=h.start_address,c=h.start_location.lat(),f=h.start_location.lng()),m==n-1&&(p=h.end_address,u=h.end_location.lat(),v=h.end_location.lng())}var b=t.get_nice_distance(l,o.unit_system),y=t.get_nice_duration(d,!1);if("object"==typeof o.field_mapping&&o.field_mapping.length)for(var w in o.field_mapping)if(o.field_mapping.hasOwnProperty(w)){var j=o.field_mapping[w],k=void 0!==j.google_route_element?j.google_route_element:"";if(""!=k){var I="";switch(k){case"distance_text":I=b;break;case"distance_value_metric":I=l;break;case"distance_value_metric_km":I=l/1e3;break;case"distance_value_imperial":I=l/1609;break;case"distance_value_imperial_yard":I=l/1609*1760;break;case"duration_text":I=y;break;case"duration_value":I=d;break;case"duration_value_minute":I=d/60;break;case"duration_value_hour":I=d/3600;break;case"duration_value_day":I=d/86400;break;case"duration_value_week":I=d/604800;break;case"duration_value_year":I=d/31536e3;break;case"start_address":I=g;break;case"start_lat":I=c;break;case"start_lng":I=f;break;case"start_lat_lng":I=c+","+f;break;case"end_address":I=p;break;case"end_lat":I=u;break;case"end_lng":I=v;break;case"end_lat_lng":I=u+","+v;break;case"summary":I=_.summary}var x=parseInt(void 0!==j.ws_form_field?j.ws_form_field:"",10);if(0!=x){var S=t.get_section_repeatable_suffix(e(o.obj)),O=e("#"+t.form_id_prefix+"field-wrapper-"+x+S,t.form_canvas_obj),D=e("#"+t.form_id_prefix+"field-"+x+S,t.form_canvas_obj);t.field_value_set(O,D,I)}}}if(""!=o.map_field_id&&void 0!==t.google_maps[o.map_field_id]){var T=t.google_maps[o.map_field_id];t.google_map_directions_renderer_init(T),T.directions_renderer.setDirections(a)}break;default:t.error("error_google_route_message",JSON.stringify(a))}i.attr("data-google-route-status",r).trigger("wsf-google-route")})}catch(e){t.error("error_google_route_message",e)}},r=function(a){var o=a.data.google_route,i=e(o.obj);a.data.obj_origin,a.data.obj_destination;if(i.removeAttr("data-place-id"),"object"==typeof o.field_mapping&&o.field_mapping.length)for(var r in o.field_mapping)if(o.field_mapping.hasOwnProperty(r)){var _=o.field_mapping[r],s=void 0!==_.google_route_element?_.google_route_element:"";if(""!=s){var n="";switch(s){case"distance_text":case"duration_text":case"start_address":case"start_lat":case"start_lng":case"start_lat_lng":case"end_address":case"end_lat":case"end_lng":case"end_lat_lng":case"summary":n="";break;case"distance_value_metric":case"distance_value_metric_km":case"distance_value_imperial":case"distance_value_imperial_yard":case"duration_value":case"duration_value_minute":case"duration_value_hour":case"duration_value_day":case"duration_value_week":case"duration_value_year":n=0}var l=parseInt(void 0!==_.ws_form_field?_.ws_form_field:"",10);if(0!=l){var d=t.get_section_repeatable_suffix(e(o.obj)),g=e("#"+t.form_id_prefix+"field-wrapper-"+l+d,t.form_canvas_obj);i=e("#"+t.form_id_prefix+"field-"+l+d,t.form_canvas_obj);t.field_value_set(g,i,n)}}}if(""!=o.map_field_id&&void 0!==t.google_maps[o.map_field_id]){var c=t.google_maps[o.map_field_id];t.google_map_directions_renderer_init(c),c.directions_renderer.set("directions",null)}},_=t.get_section_repeatable_suffix(e(a.obj)),s=e("#"+t.form_id_prefix+"field-"+a.field_id_origin+_,t.form_canvas_obj),n=e("#"+t.form_id_prefix+"field-"+a.field_id_destination+_,t.form_canvas_obj);if(!s.length||!n.length)return this.error("error_google_route"),!1;var l=this.get_field_type(s),d=this.get_field_type(n),g={google_route:a,obj_origin:s,obj_destination:n};"googleaddress"===l?(s.on("wsf-place-id-reset",g,r),s.on("wsf-place-id-set",g,i)):(s.on("change",g,r),s.on("change",g,i)),"googleaddress"===d?(n.on("wsf-place-id-reset",g,r),n.on("wsf-place-id-set",g,i)):(n.on("change",g,r),n.on("change",g,i));var c=[];for(var f in a.waypoints)if(a.waypoints.hasOwnProperty(f)){var p=a.waypoints[f],u=p.google_route_waypoint_field_id,v=p.google_route_waypoint_type;if(void 0!==this.field_data_cache[u]){var m=this.field_data_cache[u];if(m.section_repeatable)var h='[id^="'+this.esc_selector(this.form_id_prefix+"field-"+u)+'-repeat-"]';else h="#"+this.esc_selector(this.form_id_prefix+"field-"+u);"googleaddress"===m.type?(this.form_canvas_obj.on("wsf-place-id-reset",h,g,i),this.form_canvas_obj.on("wsf-place-id-set",h,g,i)):(this.form_canvas_obj.on("change",h,g,r),this.form_canvas_obj.on("change",h,g,i));var b=void 0!==m.section_repeatable_section_id&&m.section_repeatable_section_id;b&&this.form_canvas_obj.on("wsf-section-repeatable-delete-"+b+" wsf-section-repeatable-move-"+b,g,i),c.push({field_id:u,type:v,selector:h})}}g.waypoints=c,r({data:g}),"googleaddress"!==l&&"googleaddress"!==d&&i({data:g})},e.WS_Form.prototype.google_map_directions_renderer_init=function(e){if(!1===e.directions_renderer){var a={polylineOptions:{strokeColor:e.routing_polyline_color,strokeWeight:e.routing_polyline_weight}};e.routing_icon_url_origin&&(a.markerOptions={icon:{url:e.routing_icon_url_origin}}),e.directions_renderer=new google.maps.DirectionsRenderer(a),e.directions_renderer.setMap(e.map)}},e.WS_Form.prototype.google_route_get_origin_destination=function(e){if(null!==/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/.exec(e)){var a=e.split(",");return{lat:parseFloat(a[0]),lng:parseFloat(a[1])}}return e}}(jQuery);