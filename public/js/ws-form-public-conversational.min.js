!function(o){"use strict";o.WS_Form.prototype.form_conversational=function(){this.conversational=!0,this.form_conversational_navigation(),this.form_conversational_settings(),this.form_conversational_form(),this.form_conversational_section(),this.form_conversational_field(),this.form_conversational_focus(),this.form_conversational_key_down(),this.form_conversational_resize(),this.form_conversational_scroll(),this.touching=!1,this.touching_timeout=!1,this.touching_time=!1,this.focus_process=!0},o.WS_Form.prototype.form_conversational_settings=function(){this.conversational_scroll_duration=parseInt(this.get_object_meta_value(this.form,"conversational_scroll_duration",300,!1,!1)),this.window_inner_height_initial=window.innerHeight,this.section_obj_first=o(".wsf-section:visible",this.form_canvas_obj).first(),this.section_obj_last=o(".wsf-section:visible",this.form_canvas_obj).last(),this.sections_full_height=o(".wsf-form-conversational-section-full-height",this.form_canvas_obj),this.grid_gutter=parseInt(ws_form_settings.skin_grid_gutter),this.mobile=window.matchMedia("only screen and (max-width: 543px)").matches,this.mobile_scroll_reference_offset=this.grid_gutter},o.WS_Form.prototype.form_conversational_form=function(){this.mobile?this.sections_full_height.css({height:this.window_inner_height_initial-this.nav_height+"px"}):this.sections_full_height.css({height:"calc(100vh - "+this.nav_height+"px)"}),this.form_conversational_section_first_margin(),this.form_conversational_section_last_margin()},o.WS_Form.prototype.form_conversational_section_first_margin=function(){if(!this.section_obj_first.hasClass("wsf-form-conversational-section-full-height")){if(this.mobile)var o=this.grid_gutter;else{var t=this.section_obj_first.height()/2;if(this.conversational_nav&&(t+=this.nav_height/2),this.window_inner_height_initial/2-t>this.grid_gutter)o="calc(50vh - "+t+"px)";else o=this.grid_gutter}this.section_obj_first.css({"margin-top":o})}},o.WS_Form.prototype.form_conversational_section_last_margin=function(){if(!this.section_obj_last.hasClass("wsf-form-conversational-section-full-height")){if(this.mobile)var o=this.window_inner_height_initial-this.section_obj_last.height()-this.grid_gutter;else{var t=this.section_obj_last.height()/2+this.grid_gutter/2;if(this.conversational_nav&&(t-=this.nav_height/2),this.window_inner_height_initial/2-t>this.grid_gutter)o="calc(50vh - "+t+"px)";else o=this.nav_height}this.section_obj_last.css({"margin-bottom":o})}},o.WS_Form.prototype.form_conversational_navigation=function(){if(this.conversational_nav=this.get_object_meta_value(this.form,"conversational_nav","on",!1,!1),this.conversational_nav_progress_help=this.get_object_meta_value(this.form,"conversational_nav_progress_help","#progress_percent",!1,!1),this.conversational_nav){var t=this,i='<nav class="wsf-form-conversational-nav">';i+="<div><ul>",i+='<li><progress class="wsf-form-conversational-nav-progress wsf-progress" data-progress-bar data-progress-bar-value value="50" /></progress>',""!=this.conversational_nav_progress_help&&(i+='<small class="wsf-form-conversational-nav-progress-help wsf-help">'+this.conversational_nav_progress_help+"</small>"),i+="</li>",i+='<li class="wsf-form-conversational-nav-move-up" aria-label="Previous" title="Previous"><svg viewBox="0 0 16 16"><path d="M8 16c-2.1 0-4.1-.8-5.7-2.3S0 10.1 0 8s.8-4.1 2.3-5.7S5.9 0 8 0s4.1.8 5.7 2.3S16 5.9 16 8s-.8 4.1-2.3 5.7S10.1 16 8 16zM8 1.2c-3.7 0-6.8 3-6.8 6.8s3 6.8 6.8 6.8 6.8-3 6.8-6.8S11.7 1.2 8 1.2zm4.3 7.9L8 4.7 3.7 9.1l.9.9L8 6.5l3.4 3.4.9-.8z" fill="#ceced2"></path></svg></li>',i+='<li class="wsf-form-conversational-nav-move-down" aria-label="Next" title="Next"><svg viewBox="0 0 16 16"><path d="M8 0c2.1 0 4.1.8 5.7 2.3S16 5.9 16 8s-.8 4.1-2.3 5.7S10.1 16 8 16s-4.1-.8-5.7-2.3S0 10.1 0 8s.8-4.1 2.3-5.7S5.9 0 8 0zm0 14.8c3.7 0 6.8-3 6.8-6.8s-3-6.8-6.8-6.8S1.2 4.3 1.2 8s3.1 6.8 6.8 6.8zM3.7 6.9L8 11.3 12.3 7l-.9-.9L8 9.5 4.6 6.1l-.9.8z" fill="#ceced2"></path></svg></li>',i+="</ul></div>",i+="</nav>",this.form_canvas_obj.append(i);var s=o(".wsf-form-conversational-nav",this.form_canvas_obj);this.nav_height=s.outerHeight(),o(".wsf-form-conversational-nav-move-up",s).on("click",function(){t.form_conversational_section_previous()}),o(".wsf-form-conversational-nav-move-down",s).on("click",function(){t.form_conversational_section_next()})}else this.nav_height=0},o.WS_Form.prototype.form_conversational_section_previous=function(){var o=this.conversational_section_obj_focus.prevAll(":visible");o.length&&(this.conversational_section_obj_focus=o.first(),this.form_conversational_focus_section(!0,!0))},o.WS_Form.prototype.form_conversational_section_next=function(){var o=this.conversational_section_obj_focus.nextAll(":visible");o.length&&(this.conversational_section_obj_focus=o.first(),this.form_conversational_focus_section(!0,!0))},o.WS_Form.prototype.form_conversational_focus=function(){var t=this;this.conversational_section_obj_focus=this.section_obj_first,this.conversational_section_obj_focus_old=this.conversational_section_obj_focus,this.form_conversational_focus_section(!1,!0),this.form_canvas_obj.on("focus",'.wsf-field, .wsf-button, [tabindex="0"]',function(i,s){if(t.focus_process&&"wsf-internal"!==s){var n=o(this).closest(".wsf-section:visible");n[0]!==t.conversational_section_obj_focus[0]&&(t.conversational_section_obj_focus=n,t.form_conversational_focus_section(!0,!1))}})},o.WS_Form.prototype.form_conversational_focus_section=function(t,i){var s=this;this.conversational_section_obj_focus_old.removeClass("wsf-form-conversational-active").addClass("wsf-form-conversational-inactive"),this.conversational_section_obj_focus.removeClass("wsf-form-conversational-inactive").addClass("wsf-form-conversational-active");var n=this.conversational_section_obj_focus.attr("data-id"),e=this.conversational_section_obj_focus_old.attr("data-id");if(o('[id^="wsf-1-section-'+n+'-repeat-"]').removeClass("wsf-form-conversational-inactive").addClass("wsf-form-conversational-active"),n!==e&&o('[id^="wsf-1-section-'+e+'-repeat-"]').removeClass("wsf-form-conversational-active").addClass("wsf-form-conversational-inactive"),this.conversational_section_obj_focus_old=this.conversational_section_obj_focus,o('[data-type="color"] input',this.form_canvas_obj).each(function(){var t=o(this).closest(".wsf-section");"undefined"!=typeof Coloris&&t[0]!==s.conversational_section_obj_focus[0]&&Coloris.close()}),o('[data-type="datetime"] input',this.form_canvas_obj).each(function(){o(this).closest(".wsf-section")[0]!==s.conversational_section_obj_focus[0]&&o(this).datetimepicker("hide")}),t){if(this.conversational_section_obj_focus[0]===this.section_obj_first[0])t=0;else if(this.mobile)t=this.form_conversational_section_top_position(this.conversational_section_obj_focus)-this.mobile_scroll_reference_offset;else{t=this.form_conversational_section_middle_position(this.conversational_section_obj_focus)-window.innerHeight/2;this.conversational_nav&&(t+=this.nav_height/2)}!1!==this.conversational_scroll_start_x&&(o(window).scrollLeft(this.conversational_scroll_start_x),this.conversational_scroll_start_x=!1),!1!==this.conversational_scroll_start_y&&(o(window).scrollTop(this.conversational_scroll_start_y),this.conversational_scroll_start_y=!1),this.conversational_scroll_detect=!1,o("html, body").stop().animate({scrollTop:t},s.conversational_scroll_duration,function(){setTimeout(function(){s.conversational_scroll_detect=!0},200),i&&s.form_conversational_focus_first_field()})}else i&&this.form_conversational_focus_first_field()},o.WS_Form.prototype.form_conversational_focus_first_field=function(){o(".wsf-field:visible, .wsf-button:visible",this.conversational_section_obj_focus).first().trigger("focus","wsf-internal")},o.WS_Form.prototype.form_conversational_key_down=function(){var t=this;o(document).on("keydown",function(i){t.form_conversational_keydown(i,o(this))}),this.form_canvas_obj.on("keydown",".wsf-field, .wsf-button",function(i){t.form_conversational_keydown(i,o(this))})},o.WS_Form.prototype.form_conversational_keydown=function(o,t){if(this.conversational_section_obj_focus)switch(o.keyCode){case 13:!1===o.shiftKey&&(o.preventDefault(),o.stopPropagation(),this.form_conversational_field_changed(t))}},o.WS_Form.prototype.form_conversational_resize=function(){var t=this;this.conversational_resize_time=!1,this.conversational_resize_timeout=!1,this.conversational_resize_delta=200,o(window).on("resize",function(){t.conversational_resize_time=new Date,!1===t.conversational_resize_timeout&&(t.conversational_resize_timeout=!0,setTimeout(function(){t.form_conversational_resize_process()},t.conversational_resize_delta))})},o.WS_Form.prototype.form_conversational_resize_process=function(){var o=this;new Date-this.conversational_resize_time<this.conversational_resize_delta?setTimeout(function(){o.form_conversational_resize_process()},this.conversational_resize_delta):(this.conversational_resize_timeout=!1,this.form_conversational_settings(),this.form_conversational_section_first_margin(),this.form_conversational_section_last_margin(),this.mobile||this.form_conversational_focus_section(!0,!0))},o.WS_Form.prototype.form_conversational_scroll=function(){var t=this;this.conversational_scroll_detect=!0,this.conversational_scroll_start_x=!1,this.conversational_scroll_start_y=!1,o(window).on("touchstart",function(o){t.touching_time=new Date,!1!==t.touching_timeout&&clearTimeout(t.touching_timeout),t.touching=!0}),o(window).on("touchend",function(o){new Date-t.touching_time<100?t.touching=!1:t.touching_timeout=setTimeout(function(){t.touching=!1},2e3)}),o(window).on("scroll",function(i){if((!t.mobile||t.touching)&&t.conversational_scroll_detect){var s=t.mobile?o(window).scrollTop()+t.mobile_scroll_reference_offset:o(window).scrollTop()+window.innerHeight/2,n=!1,e=!1;o("fieldset",t.form_canvas_obj).each(function(){var i=t.mobile?t.form_conversational_section_top_position(o(this)):t.form_conversational_section_middle_position(o(this)),a=Math.abs(s-i);(a<e||!1===e)&&(e=a,n=o(this))}),n&&n[0]!==t.conversational_section_obj_focus[0]&&(t.conversational_section_obj_focus=n,t.form_conversational_focus_section(!1,!1))}})},o.WS_Form.prototype.form_conversational_section=function(){var t=this;o(".wsf-section:visible:first").addClass("wsf-form-conversational-active"),o(".wsf-section:not(:visible:first)").addClass("wsf-form-conversational-inactive"),this.form_canvas_obj.on("click",".wsf-section",function(i){o(i.target).filter('.wsf-field, .wsf-button, [tabindex="0"], label').length||this!==t.conversational_section_obj_focus[0]&&(t.conversational_section_obj_focus=o(this),t.form_conversational_focus_section(!0,!1))}),this.form_canvas_obj.on("click",'[data-action="wsf-section-add-button"], [data-action="wsf-section-add-icon"], [data-action="wsf-section-delete-button"], [data-action="wsf-section-delete-icon"]',function(){t.form_conversational_focus_section(!1,!1)})},o.WS_Form.prototype.form_conversational_field=function(){var t=this;this.form_canvas_obj.on("change",'.wsf-field-wrapper:not([data-type="signature"],[data-type="rating"],[data-type="color"],[data-type="checkbox"],[data-type="price_checkbox"],[data-type="radio"],[data-type="price_radio"],[data-type="range"],[data-type="price_range"],[data-type="hidden"]) .wsf-field:not([data-hidden],[data-hidden-section],[data-hidden-group])',function(i){t.form_conversational_field_changed(o(this))}),this.form_canvas_obj.on("change",".wsf-field-wrapper select:not([data-hidden],[data-hidden-section],[data-hidden-group])",function(o){o.stopPropagation()}),this.form_canvas_obj.on("mouseup",'[data-type="rating"] li',function(i){i.stopPropagation(),t.form_conversational_field_changed(o(this))}),this.form_canvas_obj.on("mouseup",'.wsf-field[type="radio"] + label',function(i){i.stopPropagation(),t.focus_process=!1,t.form_conversational_field_changed(o(this)),setTimeout(function(){t.focus_process=!0},500)})},o.WS_Form.prototype.form_conversational_field_changed=function(t){var i=t.closest(".wsf-field-wrapper"),s=i.closest(".wsf-section");if(s[0]===this.conversational_section_obj_focus[0]){var n=o('.wsf-field-wrapper:visible:not([data-type="divider"],[data-type="html"],[data-type="message"],[data-type="section_icons"],[data-type="texteditor"])',s).last();if(i[0]===n[0])this.form_conversational_section_next();else{var e=t.closest(".wsf-field-wrapper:visible",s).next();if(e.length){var a=o(".wsf-field",e).first();a.length&&a.trigger("focus","wsf-internal")}}}},o.WS_Form.prototype.form_conversational_section_middle_position=function(o){return o.offset().top+o.outerHeight()/2},o.WS_Form.prototype.form_conversational_section_top_position=function(o){return o.offset().top}}(jQuery);