!function(e){"use strict";e.WS_Form.prototype.form_cascade=function(){var a=this;e("[data-cascade-field-id]:not([data-init-cascade]) input:checked",this.form_canvas_obj).attr("data-checked",""),e("[data-cascade-field-id]:not([data-init-cascade])",this.form_canvas_obj).each(function(){var t=e(this),c=e(this).closest("[data-type]");if(void 0===e(this).attr("data-init-cascade")){var i=e(this).attr("data-cascade-field-id"),s=c.attr("data-repeatable-index");if(e('[data-cascade-field-id="'+a.esc_selector(i)+'"]',c).attr("data-init-cascade",""),void 0!==a.field_data_cache[i]){var o=a.field_data_cache[i],d=o.type,r=!1;switch(d){case"hidden":if(s)(r=e('[id^="'+a.esc_selector(a.form_id_prefix+"field-"+i)+'"][data-id-hidden="'+a.esc_selector(i)+'"][data-repeatable-index="'+a.esc_selector(s)+'"]',a.form_canvas_obj)).length||(r=!1);if(!r)r=e('[id="'+a.esc_selector(a.form_id_prefix+"field-"+i)+'"]',a.form_canvas_obj);break;default:if(s)(r=e('[id^="'+a.esc_selector(a.form_id_prefix+"field-wrapper-"+i)+'"][data-id="'+a.esc_selector(i)+'"][data-repeatable-index="'+a.esc_selector(s)+'"]',a.form_canvas_obj)).length||(r=!1);if(!r)r=e('[id="'+a.esc_selector(a.form_id_prefix+"field-wrapper-"+i)+'"]',a.form_canvas_obj)}if(r.length){var l=r.attr("data-repeatable-index");l||(l=0);var _={obj:r,id:i,field_config:o,repeatable_index:l,type:d},n=c.attr("data-id"),h=c.attr("data-repeatable-index");h||(h=0);var f={obj:c,id:n,field_config:a.field_data_cache[n],repeatable_index:h,type:c.attr("data-type")};switch(d){case"text":case"number":case"rating":case"range":case"price_range":var p="change input";break;default:p="change"}r.on(p,function(){a.form_cascade_process(_,f,t)}),a.form_cascade_process(_,f,t)}}}})},e.WS_Form.prototype.form_cascade_process=function(a,t,c){var i=this,s=t.obj,o=t.id,d=t.field_config,r=t.repeatable_index,l=t.type,_=(a.obj,a.id),n=a.repeatable_index,h=n>0?"["+n+"]":"",f=a.type,p=this.field_name_prefix+_+h,v=this.get_object_meta_value(d,l+"_cascade_option_text_no_rows","");""==v&&(v=this.language("cascade_option_text_no_rows"));var m=this.get_object_meta_value(d,l+"_cascade_no_match",!1);switch(f){case"select":case"price_select":var u=e('[name="'+this.esc_selector(p)+'[]"]',this.form_canvas_obj).val();break;case"checkbox":case"price_checkbox":case"radio":case"price_radio":u=[];e('[name="'+this.esc_selector(p)+'[]"]:checked',this.form_canvas_obj).each(function(){u.push(e(this).val())});break;default:u=e('[name="'+this.esc_selector(p)+'"]',this.form_canvas_obj).val()}switch(null===u||""===u||void 0===u||"object"==typeof u&&0===u.length?u=!1:"object"!=typeof u&&(u=[u]),l){case"select":case"price_select":var g=e("select",s);if(void 0!==c.attr("data-wsf-select2"))var b=e("+ .select2",c);else b=!1;if(void 0!==c.attr("data-cascade-ajax")){if(this.form_post_locked||"object"!=typeof this.api_call_handle[o]||this.api_call_handle[o].abort(),!1===u&&!m)return void g.html('<option value="" data-placeholder>'+this.esc_html(v)+"</option>").val("");var x=this.get_object_meta_value(d,"placeholder_row",""),j=this.get_object_meta_value(d,l+"_cascade_ajax_option_text_loading","");""==j&&(j=this.language("cascade_option_text_loading")),b&&this.form_cascade_set_select2_placeholder(g,j);var w=""!==g.val()&&null!==g.val();g.html('<option value="" data-placeholder>'+this.esc_html(j)+"</option>").val(""),w&&g.trigger("change");var y=new FormData;y.append("id",this.form_id),y.append("value",JSON.stringify(u)),y.append("preview",this.form_canvas_obj[0].hasAttribute("data-preview")),void 0!==g.attr("data-wsf-populate")&&(y.append("default_value",g.attr("data-wsf-populate")),g.removeAttr("data-wsf-populate")),this.api_call_handle[o]=this.api_call("field/"+o+"/cascade/","GET",y,function(a){if(a.data){var t=i.get_field_html(a.data,s.attr("data-repeatable-index")),c=e("select",e(t)).html();c?(b&&i.form_cascade_set_select2_placeholder(g,x),g.html(c)):(b&&i.form_cascade_set_select2_placeholder(g,v),g.html('<option value="" data-placeholder>'+i.esc_html(v)+"</option>").val("")),e("optgroup",g).each(function(){e("option",e(this)).length||e(this).remove()}),g.trigger("change")}})}else{g=e("select",s);void 0===this.cascade_cache[o]&&(this.cascade_cache[o]=[]),void 0===this.cascade_cache[o][r]&&(this.cascade_cache[o][r]='<select id="wsf-cascade-scratch">'+g.html()+"</select>");var k=e(this.cascade_cache[o][r]),O=this.get_object_meta_value(d,l+"_cascade_field_filter_comma",!1),A=!1;if(!1!==u&&e("option",k).each(function(){if("string"==typeof(c=e(this).attr("data-cascade-value"))){var a=O?c.split(","):[c];for(var t in a)if(a.hasOwnProperty(t)){var c=a[t];if(-1!==u.indexOf(c))return A=!0,!1}}}),!A)return(m=this.get_object_meta_value(d,l+"_cascade_no_match",!1))?g.html(k.html()):g.html('<option value="" data-placeholder>'+this.esc_html(v)+"</option>").val(""),void g.trigger("change");e("option",k).each(function(){if("string"==typeof(i=e(this).attr("data-cascade-value"))){var a=O?i.split(","):[i],t=!1;for(var c in a)if(a.hasOwnProperty(c)){var i=a[c];if(-1!==u.indexOf(i)){t=!0;break}}t||e(this).remove()}}),e("optgroup",k).each(function(){e("option",e(this)).length||e(this).remove()}),g.html(k.html()),g.trigger("change")}break;case"checkbox":case"price_checkbox":case"radio":case"price_radio":A=!1,O=this.get_object_meta_value(d,l+"_cascade_field_filter_comma",!1);if(!1!==u&&e("[data-cascade-value]",s).each(function(){if("string"==typeof(c=e(this).attr("data-cascade-value"))){var a=O?c.split(","):[c];for(var t in a)if(a.hasOwnProperty(t)){var c=a[t];if(-1!==u.indexOf(c))return A=!0,!1}}}),(m=this.get_object_meta_value(d,l+"_cascade_no_match",!1))&&!A)return e("[data-cascade-value]",s).show().attr("data-cascade-on",""),void e("fieldset",s).show();A?e("[data-cascade-value]",s).each(function(){if("string"==typeof(i=e(this).attr("data-cascade-value"))){var a=O?i.split(","):[i],t=!1;for(var c in a)if(a.hasOwnProperty(c)){var i=a[c];if(-1!==u.indexOf(i)){t=!0;break}}t?e(this).show().attr("data-cascade-on",""):e(this).hide().removeAttr("data-cascade-on")}}):e("[data-cascade-value]",s).hide().removeAttr("data-cascade-on"),e("fieldset",s).show().each(function(){e("[data-cascade-value][data-cascade-on]",e(this)).length||e(this).hide()}),e("[data-cascade-value]:not([data-cascade-on]) input:checked",s).each(function(){e(this).prop("checked",!1).trigger("change")}),e("[data-cascade-value][data-cascade-on] input[data-checked]:not(:checked)",s).each(function(){e(this).prop("checked",!0).trigger("change")})}},e.WS_Form.prototype.form_cascade_set_select2_placeholder=function(e,a){var t=e.data("select2");t&&t.selection&&t.selection.placeholder&&t.selection.placeholder.text&&(t.selection.placeholder.text=a)}}(jQuery);