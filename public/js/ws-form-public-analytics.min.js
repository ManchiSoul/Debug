!function(t){"use strict";t.WS_Form.prototype.form_analytics=function(){this.form_analytics_gtag(),(this.get_object_meta_value(this.form,"analytics_google",!1)||this.action_ga)&&this.form_analytics_google()},t.WS_Form.prototype.form_analytics_gtag=function(){"object"==typeof window.dataLayer&&"function"!=typeof window.gtag&&(window.gtag=function(){window.dataLayer.push(arguments)})},t.WS_Form.prototype.form_analytics_google=function(a){var e=this,i=t.WS_Form.analytics.google.functions;if(void 0===a&&(a=(new Date).getTime()),(new Date).getTime()-a>this.timeout_analytics_google)return this.error("error_timeout_analytics_google","","analytics"),this.form_analytics_gtag(),!1;var o=!1;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];if(window[n]){o=!0,this.log(r.log_found,"","analytics"),this.get_object_meta_value(this.form,"analytics_google_event_form",!0)&&this.form_analytics_process_forms("google",n),this.get_object_meta_value(this.form,"analytics_google_event_tab",!0)&&Object.keys(this.form.groups).length>0&&this.form_analytics_process_tabs("google",n),this.get_object_meta_value(this.form,"analytics_google_event_field",!0)&&this.form_analytics_process_fields("google",n),this.analytics_function.google=n;break}}o||setTimeout(function(){e.form_analytics_google(a)},this.timeout_interval)},t.WS_Form.prototype.form_analytics_process_forms=function(a,e){var i=this;if(void 0===t.WS_Form.analytics[a])return!1;var o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,r=o.label;t(document).on("wsf-submit wsf-save",function(o,n,r,s,_,l,c){if(_===i.form_obj){if("wsf-submit"==o.type&&"google"==a&&"gtag"==e){var f={event_action:"form_submit",form_id:null,form_name:null,form_destination:null,form_submit_text:null};void 0!==i.form_obj.attr("id")&&(f.form_id=i.form_obj.attr("id")),void 0!==i.form_obj.attr("name")&&(f.form_name=i.form_obj.attr("name")),void 0!==i.form_obj.attr("action")&&(f.form_destination=i.form_obj.attr("action"));var m=t('button[type="submit"]',i.form_canvas_obj);if(m.length){var y=m.first().html();y&&(f.form_submit_text=y)}i.form_analytics_event_fire(a,e,f);f={event_action:"wsf-submit"==o.type?"gtm.formSubmit":"wsf.form.save","gtm.element":"#form_obj"};void 0!==i.form_obj.attr("id")&&(f["gtm.elementId"]=i.form_obj.attr("id")),void 0!==i.form_obj.attr("class")&&(f["gtm.elementClasses"]=i.form_obj.attr("class")),void 0!==i.form_obj.attr("action")&&(f["gtm.elementUrl"]=i.form_obj.attr("action")),i.form_analytics_event_fire(a,e,f)}i.form_analytics_event_fire(a,e,{event_action:"wsf-submit"===o.type?"Submit":"Save",event_category:i.js_string_encode(i.language("analytics_category",i.form.label))})}}),i.log("log_analytics_event_form",n+" ("+r+")","analytics")},t.WS_Form.prototype.form_analytics_process_tabs=function(a,e,i){var o=this;if("data_layer"==a)return!1;var n=t.WS_Form.analytics[a].functions[e],r=t.WS_Form.analytics[a].label,s=n.label,_=void 0!==this.framework.tabs.public.selector_href?this.framework.tabs.public.selector_href:"href";t("["+_+'^="#'+this.form_id_prefix+'group-"]:not([data-init-analytics-tab-'+i+"])",this.form_canvas_obj).each(function(){t(this).attr("data-init-analytics-tab-"+i,""),t(this).on("wsf-click",function(){if(void 0===t(this).attr("data-analytics-event-fired")){var i=t(this).parent().index(),n=o.form.groups[i],r=n.label,s={event_action:"Tab",event_category:o.js_string_encode(o.language("analytics_category",o.form.label)),event_label:o.js_string_encode(r),wsf_group_id:parseInt(n.id,10)};o.form_analytics_event_fire(a,e,s),t(this).attr("data-analytics-event-fired","true")}})}),o.log("log_analytics_event_tab",r+" ("+s+")","analytics")},t.WS_Form.prototype.form_analytics_process_fields=function(a,e,i){var o=this;if(void 0===t.WS_Form.analytics[a])return!1;var n=t.WS_Form.analytics[a].functions[e],r=t.WS_Form.analytics[a].label,s=n.label;for(var _ in this.field_data_cache)if(this.field_data_cache.hasOwnProperty(_)){var l=this.field_data_cache[_].type,c=t.WS_Form.field_type_cache[l];if(void 0!==c.events){var f=c.events.event,m=this.field_data_cache[_].id,y=void 0!==c.submit_array&&c.submit_array;t('[data-type][data-id="'+this.esc_selector(m)+'"]',this.form_canvas_obj).each(function(){var n=o.get_section_repeatable_index(t(this)),r=n>0?"["+n+"]":"";if(y)var s=t('[name="'+o.esc_selector(ws_form_settings.field_prefix+m+r)+'[]"]:not([data-init-analytics-field-'+i+"])",o.form_canvas_obj);else s=t('[name="'+o.esc_selector(ws_form_settings.field_prefix+m+r)+'"]:not([data-init-analytics-field-'+i+"])",o.form_canvas_obj);s.length&&(s.attr("data-init-analytics-field-"+i,""),s.on(f,function(){if(void 0===t(this).attr("data-analytics-event-fired-"+i)){var n=o.get_field(t(this)),r={event_action:t.WS_Form.field_type_cache[n.type].events.event_action,event_category:o.js_string_encode(o.language("analytics_category",o.form.label)),event_label:o.js_string_encode(n.label),wsf_section_id:parseInt(n.section_id,10),wsf_field_id:parseInt(n.id,10)};o.form_analytics_event_fire(a,e,r),t(this).attr("data-analytics-event-fired-"+i,"true")}}))})}}o.log("log_analytics_event_field",r+" ("+s+")","analytics")},t.WS_Form.prototype.form_analytics_event_fire=function(a,e,i){if(void 0===t.WS_Form.analytics[a])return!1;var o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,r=t.WS_Form.analytics[a].functions[e].label,s=o.analytics_event_function;if("js"==e||"function"==typeof window[e]||"object"==typeof window[e])try{if("object"==typeof window.dataLayer&&"google"==a&&"gtag"==e){window.dataLayer.push(function(){this.reset()});var _={};for(var l in i)if("event_action"!=l&&i.hasOwnProperty(l)){var c=i[l];_[l]=c}_.wsf_form_id=parseInt(this.form_id,10),_.wsf_form_instance_id=parseInt(this.form_instance_id,10),_.wsf_form_label=this.js_string_encode(this.form.label),i.params=JSON.stringify(_)}void 0===i.event_category&&(i.event_category=""),void 0===i.event_label&&(i.event_label=""),void 0===i.value&&(i.value="null");var f=this.mask_parse(s,i);-1!==f.indexOf('"#form_obj"')&&(f=f.replace('"#form_obj"',"document.getElementById('"+this.form_obj.attr("id")+"')")),""!==f&&t.globalEval("(function($) {"+f+"})(jQuery);"),this.log("log_analytics_event_fired",n+" ("+r+") "+f,"analytics")}catch(t){this.error("log_analytics_event_failed",n+" ("+r+") "+f+" - Error: "+t.message,"analytics")}else this.error("log_analytics_event_failed",n+" ("+r+") "+f,"analytics")},t.WS_Form.prototype.data_layer_push=function(t){if("object"!=typeof window.dataLayer||"object"!=typeof t)return!1;var a=JSON.stringify(t);try{window.dataLayer.push(function(){this.reset()}),window.dataLayer.push(t),this.log("log_analytics_event_fired","Google Tag Manager (dataLayer) dataLayer("+a+")","analytics")}catch(t){this.error("log_analytics_event_failed","Google Tag Manager (dataLayer) dataLayer("+a+") - Error: "+t.message,"analytics")}},t.WS_Form.prototype.action_conversion=function(a,e){switch(a){case"data_layer":this.data_layer_push(e);break;default:if(void 0===a)return!1;if(void 0===t.WS_Form.analytics[a])return!1;if(void 0===t.WS_Form.analytics[a].functions)return!1;if(void 0!==this.analytics_function[a])var i=this.analytics_function[a];else i=Object.keys(t.WS_Form.analytics[a].functions)[0];this.form_analytics_event_fire(a,i,e)}this.action_js_process_next()}}(jQuery);